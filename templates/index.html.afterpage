<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Incident Tracker</title>
    <link rel="stylesheet" href="static/style.css">

    <style>
        .incident-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }
        .incident-table th,
        .incident-table td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        .incident-table th {
            background-color: #f2f2f2;
        }
        
        .incident-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .incident-card {
            border: 1px solid #ccc;
            padding: 15px;
            width: 300px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        .incident-card h3 {
            margin: 0 0 10px;
        }

        .incident-card p {
            margin: 5px 0;
        }

        .incident-actions {
            margin-top: 10px;
        }

        .incident-actions a {
            color: #007bff;
            text-decoration: none;
        }

        .incident-actions a:hover {
            text-decoration: underline;
        }

        /* Style for the toggle buttons */
        .view-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .view-toggle button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }

        .view-toggle button:hover {
            background-color: #0056b3;
        }

        .form-container {
            margin-bottom: 30px;
        }

        .search-container {
            margin-bottom: 20px;
        }

	.sort-button {
    padding: 8px 16px;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-bottom: 15px;
}

.sort-button:hover {
    background-color: #218838;
}

    </style>
</head>
<body>
    <h1>Incident Tracker</h1>

    <!-- Incident Reporting Form -->
    <div class="form-container">
        <h2>Record an Incident</h2>
        <form method="POST">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required>

            <label for="description">Description:</label>
            <textarea id="description" name="description" required></textarea>

            <div class="form-group">
                <label for="priority">Priority:</label>
                <select id="priority" name="priority" required>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                    <option value="Critical">Critical</option>
                </select>
            </div>

            <div class="form-group">
                <label for="systems_affected">Systems Affected:</label>
                <input type="text" id="systems_affected" name="systems_affected" required>
            </div>

            <label for="resolution">Resolution:</label>
            <textarea id="resolution" name="resolution"></textarea>

            <label for="root_cause">Root Cause:</label>
            <textarea id="root_cause" name="root_cause"></textarea>

            <button type="submit">Submit Incident</button>
        </form>
	{% if error_message %}
    <div class="error-message">{{ error_message }}</div>
{% endif %}
    </div>

    <!-- Search Form -->
    <div class="search-container">
        <h2>Search Incidents</h2>
        <form method="get" action="{{ url_for('index') }}">
            <input type="text" name="search" value="{{ search_query }}" placeholder="Search title or description">
            <input type="hidden" name="sort_order" value="{{ sort_order }}">
            <button type="submit">Search</button>
        </form>
    </div>

    <!-- Items Per Page Selector -->
<form method="get" action="{{ url_for('index') }}">
    <input type="hidden" name="search" value="{{ search_query }}">
    <input type="hidden" name="sort_order" value="{{ sort_order }}">
    <input type="hidden" name="view" value="{{ view }}">

    <label for="per_page">Items per page:</label>
    <select name="per_page" id="per_page" onchange="this.form.submit()">
        <option value="5" {% if per_page == 5 %}selected{% endif %}>5</option>
        <option value="10" {% if per_page == 10 %}selected{% endif %}>10</option>
        <option value="20" {% if per_page == 20 %}selected{% endif %}>20</option>
        <option value="50" {% if per_page == 50 %}selected{% endif %}>50</option>
    </select>
</form>


    <!-- View Toggle Section -->
    <div class="view-toggle">
        <form method="get" action="{{ url_for('index') }}">
            <input type="hidden" name="search" value="{{ search_query }}">
            <input type="hidden" name="sort_order" value="{{ sort_order }}">
            <button type="submit" name="view" value="table">
                Table View
            </button>
            <button type="submit" name="view" value="card">
                Card View
            </button>
        </form>
    </div>

    <!-- Incident History (Table or Card View) -->
    {% if view == 'table' %}
    <!-- Sort Button -->
<form method="get" action="{{ url_for('index') }}">
    <input type="hidden" name="search" value="{{ search_query }}">
    <input type="hidden" name="view" value="table">
    <input type="hidden" name="sort_order" value="{{ 'asc' if sort_order == 'desc' else 'desc' }}">
    <button type="submit" class="sort-button">
        Sort by Date {{ '↑ Asc' if sort_order == 'desc' else '↓ Desc' }}
    </button>
</form>

    <h2>Incident History (Table View)</h2>
    <table class="incident-table">
        <thead>
            <tr>
                <th>Title</th>
		<th>Description</th>
                <th>Priority</th>
                <th>Systems</th>
                <th>Resolution</th>
                <th>Root Cause</th>
                <th>Created</th>
                <th>Updated</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
		{% for incident in incidents.items %}
            <tr>
                <td>{{ incident.title }}</td>
                <td>{{ incident.description }}</td>
                <td>{{ incident.priority }}</td>
                <td>{{ incident.systems_affected }}</td>
                <td>{{ incident.resolution }}</td>
                <td>{{ incident.root_cause }}</td>
		<td>
    {% if incident.created_at %}
        {{ incident.created_at.strftime('%b %d, %Y %I:%M %p') }}
    {% else %}
        N/A
    {% endif %}
</td>

<td>
    {% if incident.updated_at %}
        {{ incident.updated_at.strftime('%b %d, %Y %I:%M %p') }}
    {% else %}
        N/A
    {% endif %}
</td>
	<td class="incident-actions">
    <a href="{{ url_for('edit_incident', incident_id=incident.id) }}">Edit</a> |
    <form action="{{ url_for('delete_incident', incident_id=incident.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this incident?');">
        <button type="submit" class="delete-button">Delete</button>
    </form>
</td>

            </tr>
            {% endfor %}
        </tbody>

    </table>
    {% endif %}

    {% if view == 'card' %}
    <h2>Incident History (Card View)</h2>
    <div class="incident-cards">
	    {% for incident in incidents.items %}
        <div class="incident-card">
            <h3>{{ incident.title }}</h3>
            <p><strong>Priority:</strong> {{ incident.priority }}</p>
            <p><strong>Systems Affected:</strong> {{ incident.systems_affected }}</p>
            <p><strong>Resolution:</strong> {{ incident.resolution }}</p>
            <p><strong>Root Cause:</strong> {{ incident.root_cause }}</p>
	    <p><strong>Created:</strong>
    {% if incident.created_at %}
        {{ incident.created_at.strftime('%b %d, %Y %I:%M %p') }}
    {% else %}
        N/A
    {% endif %}
</p>
<p><strong>Updated:</strong>
    {% if incident.updated_at %}
        {{ incident.updated_at.strftime('%b %d, %Y %I:%M %p') }}
    {% else %}
        N/A
    {% endif %}
</p>

            <p><strong>Description:</strong> {{ incident.description }}</p>

	    <div class="incident-actions">
    <a href="{{ url_for('edit_incident', incident_id=incident.id) }}">Edit</a> |
    <form action="{{ url_for('delete_incident', incident_id=incident.id) }}" method="POST" onsubmit="return confirm('Are you sure you want to delete this incident?');">
        <button type="submit" class="delete-button">Delete</button>
    </form>
</div>


</div>



        </div>
        {% endfor %}
    </div>
    {% endif %}


<!-- Pagination Controls -->
{% if pagination.pages > 1 %}
<div style="margin-top: 20px;">
    {% if pagination.has_prev %}
    	<a href="{{ url_for('index', page=incidents.prev_num, sort_order=sort_order, search=search_query, view=view) }}">Previous</a>
    {% endif %}

    Page {{ pagination.page }} of {{ pagination.pages }}

    {% if pagination.has_next %}
    	<a href="{{ url_for('index', page=incidents.prev_num, sort_order=sort_order, search=search_query, view=view) }}">Next</a>
    {% endif %}
</div>
{% endif %}



</body>
</html>

